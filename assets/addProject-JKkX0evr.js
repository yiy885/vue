import{u as te,c as re,a as f,b as _}from"./index.esm-DQt5rfF2.js";import{_ as se,n as d,u as oe,p as ie,E as ue,g as ne,i as c,w as t,r as k,o as n,a as r,j as u,c as M,J as m,F as D,b as e,L as de,M as y,N as P,t as U,O as pe,d as ce,P as me,Q as ve,y as ge,R as fe,S as V,l as x,T as _e,U as j,V as b}from"./index-C6sdhQla.js";import{p as ye}from"./project-CTpG9-4P.js";import{b as J}from"./route-block-B_A1xBdJ.js";const be={class:"dialog-content"},we={style:{color:"red"}},ke={style:{color:"red"}},Ve={style:{color:"red"}},xe=["src"],Be={class:"el-upload-list__item-actions"},Ee=["onClick"],$={__name:"addProject",setup(Ie){const B=(l,a="success")=>ue({message:l,type:a}),N=ne(),E=d(!0),o=d(0),p=d([]),R=[{label:"動態影片類型",value:"動態影片類型"},{label:"靜態影像類型",value:"靜態影像類型"},{label:"平面設計類型",value:"平面設計類型"},{label:"其他",value:"其他"}],z={name:[{required:!0,message:"專案名稱是必填的",trigger:"blur"},{min:1,max:15,message:"名稱長度需在 1 到 15 個字之間",trigger:"blur"}],description:[{required:!0,mes0sage:"專案簡介是必填的",trigger:"blur"},{min:1,max:500,message:"描述長度需在 1 到 500 個字之間",trigger:"blur"}],createdBy:[{required:!0,message:"創建者是必填的",trigger:"blur"}],category:[{required:!0,message:"請選擇專案類別",trigger:"change"}],previewImage:[{required:!0,message:"請上傳專案預視圖，盡量為正方形比例",trigger:"change"}]},T=R.map(l=>l.value),{handleSubmit:H,resetForm:Se,values:Q,validateField:I}=te({validationSchema:re({name:f().required("專案名稱是必填的").min(1,"名稱長度需在 1 到 15 個字之間").max(15,"名稱長度需在 1 到 15 個字之間"),description:f().required("專案簡介是必填的").min(1,"描述長度需在 1 到 500 個字之間").max(500,"描述長度需在 1 到 500 個字之間"),category:f().required("分類是必填的").oneOf(T,"請選擇有效的專案類別"),createdBy:f().required("創建者是必填的"),previewImage:f().required("請上傳專案預視圖，盡量為正方形比例")}),initialValues:{name:"",description:"",createdBy:"",category:"",previewImage:""}}),h=d(null),S=_("name"),C=_("description"),F=_("createdBy"),G=_("category"),w=_("previewImage"),q=d([]),v=d(null),g=d(!1);d(!1),d(""),oe(),ie(()=>{E.value=!0});const L=l=>{p.value=p.value.filter(a=>a.uid!==l.uid),w.value.value="",v.value&&v.value.clearFiles(),b({title:"提示",message:"圖片已移除，請重新上傳新圖片",type:"info"}),I("previewImage")},A=()=>{b({title:"錯誤",message:"只能上傳一張圖片！",type:"error"})},K=l=>{if(l.raw){if(l.raw.size>1024*1024||!["image/jpeg","image/png"].includes(l.raw.type)){b({title:"錯誤",message:l.raw.size>1024*1024?"檔案大小不得超過 1MB":"僅支援 JPEG/PNG 格式",type:"error"}),p.value=[],w.value.value="",v.value&&v.value.clearFiles(),I("previewImage");return}p.value=[l],w.value.value=l.name,b({title:"成功",message:"圖片上傳成功！可點擊刪除圖示重新上傳",type:"success"}),I("previewImage")}},O=H(async l=>{var a;try{if((a=q.value[0])!=null&&a.error){B({text:"請選擇有效的圖片檔案",snackbarProps:{color:"red"}});return}const i=new FormData;i.append("name",l.name),i.append("description",l.description),i.append("createdBy",l.createdBy),i.append("category",l.category),i.append("previewImage",p.value[0].raw),q.value.length>0&&i.append("previewImage",q.value[0].file),await ye.create(i),B("專案儲存成功","success"),N.push("/user/editProject")}catch(i){console.error("提交表單失敗:",i),B("提交失敗，請稍後再試","error")}}),W=async()=>{o.value===1?await h.value.validate()?o.value++:console.log("表單驗證失敗"):o.value===2?await O():o.value++},X=()=>{o.value>0&&o.value--},Y=l=>{o.value===2?l():b({title:"提示",message:"請完成所有步驟後再關閉視窗！",type:"warning"})},Z=()=>{N.push("/")};return(l,a)=>{const i=k("el-icon"),ee=k("el-dialog"),ae=k("el-main"),le=k("el-container");return n(),c(le,{class:"project-container"},{default:t(()=>[r(ae,null,{default:t(()=>[r(ee,{modelValue:E.value,"onUpdate:modelValue":a[5]||(a[5]=s=>E.value=s),title:"創建新專案",width:"60%","before-close":Y,top:"30vh"},{footer:t(()=>[o.value>0?(n(),c(e(V),{key:0,onClick:X,disabled:g.value},{default:t(()=>a[10]||(a[10]=[x("返回上一步",-1)])),_:1,__:[10]},8,["disabled"])):m("",!0),o.value===1?(n(),c(e(V),{key:1,onClick:Z},{default:t(()=>a[11]||(a[11]=[x("沒有要新增，回首頁",-1)])),_:1,__:[11]})):m("",!0),o.value<2?(n(),c(e(V),{key:2,onClick:W,disabled:g.value},{default:t(()=>a[12]||(a[12]=[x("下一步",-1)])),_:1,__:[12]},8,["disabled"])):m("",!0),o.value===2?(n(),c(e(V),{key:3,onClick:e(O),disabled:g.value,loading:g.value,underline:!1},{default:t(()=>a[13]||(a[13]=[x("提交",-1)])),_:1,__:[13]},8,["onClick","disabled","loading"])):m("",!0)]),default:t(()=>[u("div",be,[o.value===0?(n(),M(D,{key:0},[a[6]||(a[6]=u("p",null,"成功的專案即使是過程也充滿了故事性，",-1)),a[7]||(a[7]=u("p",null,"在這裡留下你的想法!",-1)),a[8]||(a[8]=u("p",{class:"mt-4 text-sm text-gray-500"},"（請先填寫專案基本資訊，然後會進入網頁編輯器）",-1))],64)):o.value===1?(n(),c(e(de),{key:1,model:e(Q),rules:z,ref_key:"formRef",ref:h,"label-width":"120px"},{default:t(()=>[r(e(y),{label:"專案名稱",prop:"name"},{default:t(()=>[r(e(P),{modelValue:e(S).value.value,"onUpdate:modelValue":a[0]||(a[0]=s=>e(S).value.value=s),placeholder:"請輸入專案名稱"},null,8,["modelValue"]),u("div",we,U(e(S).errorMessage),1)]),_:1}),r(e(y),{label:"專案簡介",prop:"description"},{default:t(()=>[r(e(P),{type:"textarea",modelValue:e(C).value.value,"onUpdate:modelValue":a[1]||(a[1]=s=>e(C).value.value=s),placeholder:"請輸入專案簡介",rows:3},null,8,["modelValue"]),u("div",ke,U(e(C).errorMessage),1)]),_:1}),r(e(y),{label:"創建者",prop:"createdBy"},{default:t(()=>[r(e(P),{modelValue:e(F).value.value,"onUpdate:modelValue":a[2]||(a[2]=s=>e(F).value.value=s),placeholder:"請輸入創建者"},null,8,["modelValue"]),u("div",Ve,U(e(F).errorMessage),1)]),_:1}),r(e(y),{label:"專案類別"},{default:t(()=>[r(e(pe),{modelValue:e(G).value.value,"onUpdate:modelValue":a[3]||(a[3]=s=>e(G).value.value=s),placeholder:"請選擇類別"},{default:t(()=>[(n(),M(D,null,ce(R,s=>r(e(me),{key:s.value,label:s.label,value:s.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),r(e(y),{label:"專案預視圖",prop:"previewImage",error:e(w).errorMessage.value},{default:t(()=>[r(e(ve),{ref_key:"uploadRef",ref:v,"file-list":p.value,"onUpdate:fileList":a[4]||(a[4]=s=>p.value=s),"list-type":"picture-card","auto-upload":!1,limit:1,accept:"image/jpeg,image/png","on-change":K,"on-remove":L,"on-exceed":A,"show-file-list":!0,"aria-label":"上傳專案預視圖","aria-describedby":"upload-tip"},{file:t(({file:s})=>[u("div",null,[u("img",{class:"el-upload-list__item-thumbnail",src:s.url,alt:"預視圖"},null,8,xe),u("span",Be,[g.value?m("",!0):(n(),M("span",{key:0,class:"el-upload-list__item-delete",onClick:Ce=>L(s)},[r(i,null,{default:t(()=>[r(e(fe))]),_:1})],8,Ee))])])]),tip:t(()=>a[9]||(a[9]=[u("div",{id:"upload-tip",class:"el-upload__tip"}," 僅支援 JPEG/PNG 格式，檔案大小不得超過 1MB，建議上傳正方形圖片 ",-1)])),default:t(()=>[p.value.length===0?(n(),c(i,{key:0},{default:t(()=>[r(e(ge))]),_:1})):m("",!0)]),_:1},8,["file-list"])]),_:1},8,["error"])]),_:1},8,["model"])):m("",!0)])]),_:1},8,["modelValue"]),r(e(_e),{active:o.value,"finish-status":"success","align-center":""},{default:t(()=>[r(e(j),{title:"步驟 1",description:"創建新專案"}),r(e(j),{title:"步驟 2",description:"設定專案參數"}),r(e(j),{title:"步驟 3",description:"儲存並提交"})]),_:1},8,["active"])]),_:1})]),_:1})}}};typeof J=="function"&&J($);const Ue=se($,[["__scopeId","data-v-d74f5c39"]]);export{Ue as default};
