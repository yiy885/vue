import{u as J,n as S,i as V,w as a,r as n,g as K,o as c,a as l,b as z,j as F,t as M,c as p,Q as W,s as y,O as X,F as R,y as Y,l as h,E as x}from"./index-Blk4pwDk.js";import{d as P}from"./vuedraggable.umd-B4I28nMv.js";import{p as Z}from"./page-DLBQmZFu.js";const ee={key:0,class:"canvas",style:{"min-height":"500px",display:"flex","justify-content":"center","align-items":"center"}},le=["src","autoplay"],ie={__name:"editProject-odd",setup(te){const C=K(),b=J(),T=[{type:"text",name:"文字模塊",content:[{field:"text",value:"",rules:["required","max:200"]},{field:"fontSize",value:16,rules:["min:12","max:48"]},{field:"color",value:"#000000",rules:["color"]},{field:"align",value:"left",rules:["enum:left,center,right"]}]},{type:"image",name:"圖片模塊",content:[{field:"url",value:"",rules:["required","url"]},{field:"alt",value:"",rules:[]},{field:"width",value:300,rules:["min:100"]},{field:"height",value:200,rules:["min:100"]}]},{type:"video",name:"影片模塊",content:[{field:"url",value:"",rules:["required","url"]},{field:"autoplay",value:!1,rules:[]},{field:"thumbnail",value:"",rules:["url"]}]},{type:"custom",name:"自訂模塊",content:[{field:"customField",value:"",rules:["required"]}]}],m=S([]),j=S(!0),q=S([]),B=async()=>{var d,o;try{if(await Promise.all([new Promise((s,r)=>{this.$refs.titleForm.validate(_=>_?s():r())}),...m.value.map((s,r)=>new Promise((_,f)=>{this.$refs[`formRef${r}`][0].validate(u=>u?_():f())}))]),!b.id){x.error("請先登錄"),C.push("/login");return}q.value=[];const g=await Z.save(b.id,{title:pageTitle.value,modules:m.value.map(({id:s,...r})=>r),partialUpdate:!1});x.success("網頁已保存"),C.push(`/project/${b.id}`)}catch(g){const s=(o=(d=g.response)==null?void 0:d.data)==null?void 0:o.error;Array.isArray(s)?(q.value=s,s.forEach(r=>x.error(r.error))):x.error(s||"無法保存網頁")}};return(d,o)=>{const g=n("el-menu-item"),s=n("el-menu"),r=n("el-card"),_=n("el-aside"),f=n("el-input"),u=n("el-form-item"),$=n("el-form"),v=n("el-col"),U=n("el-button"),E=n("el-row"),N=n("el-icon"),A=n("el-color-picker"),k=n("el-option"),L=n("el-select"),D=n("el-image"),I=n("el-upload"),O=n("el-checkbox"),Q=n("el-empty"),G=n("el-main"),H=n("el-container");return c(),V(H,{style:{height:"100vh"}},{default:a(()=>[l(_,{width:"240px",style:{background:"#141414",padding:"16px"}},{default:a(()=>[l(r,{shadow:"always"},{header:a(()=>o[2]||(o[2]=[F("h3",null,"模塊工具",-1)])),default:a(()=>[l(s,null,{default:a(()=>[l(z(P),{list:T,group:"modules",clone:d.cloneModule,"item-key":"type",sort:!1},{item:a(({element:t})=>[l(g,{class:"module-item"},{default:a(()=>[F("span",null,M(t.name),1)]),_:2},1024)]),_:1},8,["clone"])]),_:1})]),_:1})]),_:1}),l(G,{style:{padding:"16px"}},{default:a(()=>[l(r,{shadow:"always"},{header:a(()=>[l(E,{gutter:20},{default:a(()=>[l(v,{span:18},{default:a(()=>[l($,{model:{title:d.pageTitle},rules:d.titleRules,ref:"titleForm"},{default:a(()=>[l(u,{prop:"title"},{default:a(()=>[l(f,{modelValue:d.pageTitle,"onUpdate:modelValue":o[0]||(o[0]=t=>d.pageTitle=t),placeholder:"輸入網頁標題",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1}),l(v,{span:6,style:{"text-align":"right"}},{default:a(()=>[l(U,{type:"primary",onClick:B},{default:a(()=>o[3]||(o[3]=[h("保存網頁",-1)])),_:1,__:[3]})]),_:1})]),_:1})]),default:a(()=>[j.value?(c(),p("div",ee,[l(N,{size:40,class:"is-loading"},{default:a(()=>[l(z(W))]),_:1})])):(c(),V(z(P),{key:1,modelValue:m.value,"onUpdate:modelValue":o[1]||(o[1]=t=>m.value=t),group:"modules","item-key":"id",class:"canvas",style:{"min-height":"500px",border:"1px dashed #ccc",padding:"16px"}},{item:a(({element:t,index:w})=>[l(r,{class:X(["module-card",{error:d.hasError(w)}]),shadow:"hover"},{default:a(()=>[l($,{model:t,rules:d.formRules(t),ref:`formRef${w}`},{default:a(()=>[t.type==="text"?(c(),p(R,{key:0},[l(u,{prop:"content.find(c => c.field === 'text').value"},{default:a(()=>[l(f,{modelValue:t.content.find(e=>e.field==="text").value,"onUpdate:modelValue":e=>t.content.find(i=>i.field==="text").value=e,type:"textarea",rows:4,placeholder:"輸入文字內容",style:{"margin-bottom":"8px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(E,{gutter:10},{default:a(()=>[l(v,{span:8},{default:a(()=>[l(u,{prop:"content.find(c => c.field === 'fontSize').value"},{default:a(()=>[l(f,{modelValue:t.content.find(e=>e.field==="fontSize").value,"onUpdate:modelValue":e=>t.content.find(i=>i.field==="fontSize").value=e,modelModifiers:{number:!0},type:"number",placeholder:"字體大小",min:12,max:48},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),l(v,{span:8},{default:a(()=>[l(u,{prop:"content.find(c => c.field === 'color').value"},{default:a(()=>[l(A,{modelValue:t.content.find(e=>e.field==="color").value,"onUpdate:modelValue":e=>t.content.find(i=>i.field==="color").value=e},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),l(v,{span:8},{default:a(()=>[l(u,{prop:"content.find(c => c.field === 'align').value"},{default:a(()=>[l(L,{modelValue:t.content.find(e=>e.field==="align").value,"onUpdate:modelValue":e=>t.content.find(i=>i.field==="align").value=e,placeholder:"對齊方式"},{default:a(()=>[l(k,{label:"左對齊",value:"left"}),l(k,{label:"居中",value:"center"}),l(k,{label:"右對齊",value:"right"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t.content.find(e=>e.field==="text").value?(c(),p("p",{key:0,style:Y([{fontSize:t.content.find(e=>e.field==="fontSize").value+"px",color:t.content.find(e=>e.field==="color").value,textAlign:t.content.find(e=>e.field==="align").value},{"margin-top":"8px"}])},M(t.content.find(e=>e.field==="text").value),5)):y("",!0)],64)):t.type==="image"?(c(),p(R,{key:1},[t.content.find(e=>e.field==="url").value?(c(),V(D,{key:0,src:t.content.find(e=>e.field==="url").value,alt:t.content.find(e=>e.field==="alt").value,style:{"max-width":"200px","margin-bottom":"8px"},fit:"contain"},null,8,["src","alt"])):y("",!0),l(I,{action:"#","http-request":e=>d.uploadImage(e,t.id),"show-file-list":!1,accept:"image/*",style:{"margin-bottom":"8px"}},{default:a(()=>[l(U,{type:"primary"},{default:a(()=>o[4]||(o[4]=[h("上傳圖片",-1)])),_:1,__:[4]})]),_:2},1032,["http-request"]),l(u,{prop:"content.find(c => c.field === 'url').value"},{default:a(()=>[l(f,{modelValue:t.content.find(e=>e.field==="url").value,"onUpdate:modelValue":e=>t.content.find(i=>i.field==="url").value=e,placeholder:"圖片 URL",style:{"margin-bottom":"8px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(u,{prop:"content.find(c => c.field === 'alt').value"},{default:a(()=>[l(f,{modelValue:t.content.find(e=>e.field==="alt").value,"onUpdate:modelValue":e=>t.content.find(i=>i.field==="alt").value=e,placeholder:"圖片描述"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)],64)):t.type==="video"?(c(),p(R,{key:2},[t.content.find(e=>e.field==="url").value?(c(),p("video",{key:0,src:t.content.find(e=>e.field==="url").value,autoplay:t.content.find(e=>e.field==="autoplay").value,controls:"",style:{"max-width":"200px","margin-bottom":"8px"}},null,8,le)):y("",!0),l(u,{prop:"content.find(c => c.field === 'url').value"},{default:a(()=>[l(f,{modelValue:t.content.find(e=>e.field==="url").value,"onUpdate:modelValue":e=>t.content.find(i=>i.field==="url").value=e,placeholder:"影片 URL",style:{"margin-bottom":"8px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(u,{prop:"content.find(c => c.field === 'thumbnail').value"},{default:a(()=>[l(f,{modelValue:t.content.find(e=>e.field==="thumbnail").value,"onUpdate:modelValue":e=>t.content.find(i=>i.field==="thumbnail").value=e,placeholder:"縮圖 URL",style:{"margin-bottom":"8px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(O,{modelValue:t.content.find(e=>e.field==="autoplay").value,"onUpdate:modelValue":e=>t.content.find(i=>i.field==="autoplay").value=e},{default:a(()=>o[5]||(o[5]=[h("自動播放",-1)])),_:2,__:[5]},1032,["modelValue","onUpdate:modelValue"])],64)):y("",!0),l(U,{type:"danger",onClick:e=>d.removeModule(w),style:{"margin-top":"8px"}},{default:a(()=>o[6]||(o[6]=[h(" 移除模塊 ",-1)])),_:2,__:[6]},1032,["onClick"])]),_:2},1032,["model","rules"])]),_:2},1032,["class"])]),footer:a(()=>[m.value.length?y("",!0):(c(),V(Q,{key:0,description:"請拖放模塊到這裡"}))]),_:1},8,["modelValue"]))]),_:1})]),_:1})]),_:1})}}};export{ie as default};
